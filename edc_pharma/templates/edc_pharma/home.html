{% extends 'edc_base/base.html' %}

{% load staticfiles %}

{% block extra-scripts %}
	<script type="text/javascript" src="{% static "edc_pharma/js/edc_pharma.js" %}"></script>
    <script type="text/javascript" charset="utf8" class="init">
    	document.ready()
    </script> 
{% endblock extra-scripts %}

{% block main %}

 <div class="container">
 <form action="{% url 'home_url' %}" method="get" accept-charset="utf-8">
		<div class=col-md-3>
		</div>
		<div class="form-group col-md-4">
    		<input class="form-control" type="text" name="subject_identifier" placeholder="Filter Patients by Subject Identifier"></input>
    	</div>
    	
    	<div class="form-group col-md-1">
    		<button type="submit" class="btn btn-default">Search</button>
    	</div>
   
 </form>
 	
    <div class="col-md-8">
    	{% if patient_exists > 0 %}
    			{% if dispenses %}
                      
        <div class="panel-group">
          <div class="panel panel-default">
          <div class="panel-heading">Dispenses for Patient: {{ subject_identifier }} Consent Date: {{ consent_datetime }}	 <a href="/admin/edc_pharma/dispense/add/?patient={{ subject_identifier }}">Add dispense For This Patient</a></div>
                <div class="panel-body">
                  <table id="tbl-dispense-data" class="table table-striped table_responsive">
                  <thead><th>Subject Identifier</th><th>Medication</th><th>Teaspoons/Tablets</th><th>Times a Day</th><th>Total Dosage</th></thead>
                  {% for dispense in dispenses %}
                  <form action="{% url 'home_url' %}" method="get">
                  	<input type="text" name="pk" value="{{ dispense.id }}" style="display:none">
                  		<tr> 
                  			<td> {{ dispense.patient }} </td>
                  			<td> {{ dispense.medication }} </td>
                  			<td> {{ dispense.number_of_tablets_or_teaspoons }} </td>
                  			<td> {{ dispense.times_per_day }} </td> 
                  			<td> {{ dispense.total_number_of_tablets }} </td>
                  			<td> <button class="btn btn-default" type="submit" >Print</button></td>                       			
                  		</tr>
                 </form>
                 {% endfor %}
                  </table>
                </div>         
         </div>
    </div>                      	
                     {% else %}
        <div class="panel-group">
          <div class="panel panel-default">
          <div class="panel-heading">This patient has no dispense, add a dispense <a href="/admin/edc_pharma/dispense/add/?patient={{ subject_identifier }}">here</a></div>
                <div class="panel-body">
                  <table id="tbl-dispense-data" class="table table-striped table_responsive">
                  <thead><th>Subject Identifier</th><th>Medication</th><th>Teaspoons/Tablets</th><th>Times a Day</th><th>Total Dosage</th></thead>
                  </table>
                </div>         
         </div>
    </div>                    	
                      	
                      	
                   {% endif %}
        {% else %}
        <div class="panel-group">
          <div class="panel panel-default">
          <div class="panel-heading">No patient found, add patients <a href="/admin/edc_pharma/patient/add/">Here</a></div>
                <div class="panel-body">
                  <table id="tbl-dispense-data" class="table table-striped table_responsive">
                  <thead><th>Subject Identifier</th><th>Medication</th><th>Teaspoons/Tablets</th><th>Times a Day</th><th>Total Dosage</th></thead>
                  </table>
                </div>         
         </div>
    </div>  
         {% endif %}           	
   </div>

    <div class="col-md-4">
        <div class="panel-group">
          <div class="panel panel-warning">
            <div class="panel-heading">Administration</div>
                <div class="panel-body">
                    <ul id="nav-pill-home" class="nav nav-pills nav-stacked">
                      <li class="active"><a href="{% url 'edc_pharma_admin:index' %}" disabled">Admin 
                            <span class="glyphicon glyphicon-home pull-right" aria-hidden="true"></span>
                      </a></li>
                       <li><a id="pill-call-manager" href="{% url 'edc-label:home_url' %}">Edc Label                         
                      </a></li>
                       <li><a id="pill-call-manager" href="/admin/edc_pharma/dispense/add/">Add new dispense                            
                      </a></li>
                       <li><a id="pill-call-manager" href="/admin/edc_pharma/patient/add/">Add new patient                          
                      </a></li>
                       <li><a id="pill-call-manager" href="/admin/edc_pharma/protocol/add/">Add new protocol                          
                      </a></li>
                       <li><a id="pill-call-manager" href="/admin/edc_pharma/site/add/">Add new site                            
                      </a></li>
                       <li><a id="pill-call-manager" href="/admin/edc_pharma/medication/add/">Add new medication                           
                      </a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div><!--div-home-left -->
</div> <!-- container -->
{% endblock main %}