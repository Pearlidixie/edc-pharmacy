{% extends 'edc_base/base.html' %}

{% load staticfiles %}
{% block extra-scripts %}
	<script type="text/javascript" src="{% static "edc_pharma/js/edc_pharma.js" %}"></script>
{% endblock extra-scripts %}
{% block main %}

 <div class="container">
 <form action="{% url 'home_url' %}" method="get" accept-charset="utf-8">
		<div class=col-md-3>
		</div>
		<div class="form-group col-md-4">
    		<input class="form-control" type="text" name="subject_identifier" placeholder="Filter Patients by Subject Identifier"></input>
    	</div>   	
    	<div class="form-group col-md-1">
    		<button type="submit" class="btn btn-default">Search</button>
    	</div>  
 </form>
 	
    <div class="col-md-8">
    	{% if patient %}
    			{% if dispenses %}
                      
        <div class="panel-group">
          <div class="panel panel-default">
          <div class="panel-heading clearfix">Dispening history: {{ patient }}
 			<a href="{% url 'edc_pharma_admin:edc_pharma_dispense_add' %}?patient={{patient.pk}}" class="btn btn-default pull-right" role="button">Add</a>
          </div>
                <div class="panel-body">
                  <table id="tbl-dispense-data" class="table table-striped table_responsive">
                  <thead><th>Medication</th><th>Prepared Date</th><th></th></thead>
                  {% for dispense in dispenses %}
                  		<tr> 
                  			<td> {{ dispense.medication }} </td>
                  			<td> {{ dispense.prepared_datetime }} </td>
                  			<td> <a href="{% url 'home_url' dispense.pk %}" class="btn btn-default">Print</a></td>                       			
                  		</tr>
                 {% endfor %}
                  </table>
                </div>         
         </div>
    </div>                      	
                     {% else %}
        <div class="panel-group">
          <div class="panel panel-default">
          <div class="panel-heading clearfix">{{ patient }} has no dispense history <a href="{% url 'edc_pharma_admin:edc_pharma_dispense_add' %}?patient={{patient.pk}}" class="btn btn-default pull-right">Add</a></div>
                <div class="panel-body">
                  <table id="tbl-dispense-data" class="table table-striped table_responsive">
                  <thead><th>Medication</th><th>Prepared Date</th><th></th></thead>
                  </table>
                </div>         
         </div>
    </div>                    	
                      	
                      	
                   {% endif %}
        {% else %}
        <div class="panel-group">
          <div class="panel panel-default">
          <div class="panel-heading">No patient found, add patients <a href="{% url 'edc_pharma_admin:edc_pharma_patient_add' %}" class="btn btn-default">Here</a></div>
                <div class="panel-body">
                  <table id="tbl-dispense-data" class="table table-striped table_responsive">
                  <thead><th>Medication</th><th>Prepared Date</th><th></th></thead>
                  </table>
                </div>         
         </div>
    </div>  
         {% endif %}           	
   </div>

    <div class="col-md-4">
        <div class="panel-group">
          <div class="panel panel-warning">
            <div class="panel-heading">Administration</div>
                <div class="panel-body">
                    <ul id="nav-pill-home" class="nav nav-pills nav-stacked">
                      <li class="active"><a href="{% url 'edc_pharma_admin:index' %}" disabled">Admin 
                            <span class="glyphicon glyphicon-home pull-right" aria-hidden="true"></span>
                      </a></li>
                       <li><a id="pill-call-manager" href="{% url 'edc-label:home_url' %}">Edc Label                         
                      </a></li>
                       <li><a id="pill-call-manager" href="{% url 'edc_pharma_admin:edc_pharma_dispense_add' %}">Add new dispense                            
                      </a></li>
                       <li><a id="pill-call-manager" href="{% url 'edc_pharma_admin:edc_pharma_patient_add' %}">Add new patient                          
                      </a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div><!--div-home-left -->
</div> <!-- container -->
{% endblock main %}